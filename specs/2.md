Perfect ğŸ‘ â€” you want a **full â€œcontext fileâ€** that you can drop into your repo so AI assistants (Copilot, Cursor, Codeium, etc.) understand the **entire Truemailer dev lifecycle**: design â†’ build â†’ test â†’ deploy â†’ scale.

This will act like a **supercharged SPEC.md + CONTRIBUTING.md + roadmap** all in one.

---

# ğŸ“ Truemailer â€“ AI Context File

This document defines the **complete development context** for the Truemailer project.
It should guide AI IDE assistants (Copilot, Cursor, etc.) through the entire lifecycle:
**planning â†’ development â†’ testing â†’ deployment â†’ scaling.**

---

## ğŸ” 1. Project Overview

* **Name:** Truemailer
* **Type:** Email Validation API (SaaS)
* **Core Purpose:** Verify if an email is valid, disposable, or spammy.
* **Deployment:** Cloudflare Workers
* **Frontend (later):** Next.js (Cloudflare Pages) for docs + dashboard
* **API Framework:** Hono (TypeScript)
* **Runtime (dev):** Bun
* **Database:** Cloudflare D1 (SQL) + KV for fast lookups

---

## ğŸš€ 2. Features

### MVP

* Syntax validation (RFC 5322 compliant regex)
* Domain & MX record validation
* Disposable/temporary email detection (blocklist JSON)
* Spam scoring heuristics
* API key authentication (KV + D1)
* Usage tracking per key

### Roadmap

* SMTP verification (Pro plan feature)
* Catch-all detection
* Stripe/Razorpay billing integration
* Admin dashboard for managing users + API keys
* Docs site + interactive API playground
* Auto-updated disposable email list via GitHub Actions
* Analytics & fraud detection (flag suspicious usage patterns)

---

## ğŸ› ï¸ 3. Architecture

### Request Flow

```
Client â†’ Cloudflare Worker (Hono) â†’ Middleware (Auth) â†’ Validation Logic â†’ Response
```

### Components

* **Hono Router** â†’ defines endpoints (`/validate`, `/health`)
* **Middleware** â†’ API key validation + rate limiting
* **Validation Utils** â†’ syntax, MX, disposable, spam scoring
* **Database Layer** â†’ D1 for users/keys/usage, KV for fast API key lookups
* **Deployment** â†’ `wrangler.toml` config

---

## ğŸ“‚ 4. Folder Structure

```
truemailer/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ index.ts            # Main Hono entrypoint
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ validate.ts     # Syntax + MX checks
â”‚   â”‚   â”œâ”€â”€ disposable.ts   # Disposable domain list
â”‚   â”‚   â”œâ”€â”€ spam.ts         # Spam scoring heuristics
â”‚   â””â”€â”€ middleware/
â”‚       â””â”€â”€ auth.ts         # API key auth middleware
â”‚â”€â”€ db/
â”‚   â”œâ”€â”€ schema.sql          # D1 schema
â”‚   â””â”€â”€ migrations/         # SQL migrations
â”‚â”€â”€ tests/
â”‚   â”œâ”€â”€ validate.test.ts    # Unit tests
â”‚   â””â”€â”€ api.test.ts         # Integration tests
â”‚â”€â”€ package.json
â”‚â”€â”€ wrangler.toml
â”‚â”€â”€ README.md
â”‚â”€â”€ CONTEXT.md              # This file
```

---

## ğŸ—„ï¸ 5. Database Design (D1)

```sql
-- Users table
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  plan TEXT DEFAULT 'free',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- API Keys
CREATE TABLE api_keys (
  key TEXT PRIMARY KEY,
  user_id TEXT REFERENCES users(id),
  active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Usage Logs
CREATE TABLE usage (
  id TEXT PRIMARY KEY,
  api_key TEXT REFERENCES api_keys(key),
  count INTEGER DEFAULT 0,
  month TEXT, -- format: YYYY-MM
  last_used TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## ğŸ”‘ 6. API Spec

### `GET /validate`

Validate an email.

**Query Params:**

* `email` (string, required)
* `apikey` (string, required)

**Response:**

```json
{
  "email": "test@gmail.com",
  "valid_syntax": true,
  "domain_exists": true,
  "is_disposable": false,
  "spam_score": 5,
  "verdict": "good"
}
```

### `GET /health`

Health check endpoint.

```json
{ "status": "ok" }
```

---

## ğŸ§ª 7. Testing Strategy

* **Unit Tests** â†’ validation logic (`spam.ts`, `validate.ts`).
* **Integration Tests** â†’ API endpoint responses.
* **Load Testing** â†’ k6 / wrk to simulate high request volume.
* **CI/CD** â†’ GitHub Actions runs tests on push.

---

## âš¡ 8. Deployment

* **Platform:** Cloudflare Workers
* **Config:** `wrangler.toml`
* **Commands:**

  ```bash
  bun install
  bun run dev       # local dev
  wrangler dev      # worker dev
  wrangler publish  # deploy
  ```

---

## ğŸ“Š 9. Monitoring & Scaling

* **Logs:** Cloudflare Logs for request monitoring
* **Quota Enforcement:** Durable Objects (per-key request counter)
* **Caching:** Cloudflare KV for API key validation
* **Error Tracking:** Sentry/Logflare integration

---

## ğŸ“ˆ 10. Development Lifecycle Checklist

âœ… **Plan** â†’ Define features & schema
âœ… **Build** â†’ Implement Hono routes + utils
âœ… **Test** â†’ Unit + integration tests
âœ… **Deploy** â†’ Publish on Cloudflare Workers
âœ… **Monitor** â†’ Logs, error tracking
ğŸ”œ **Scale** â†’ Rate limits, billing, dashboard

---

## ğŸ¤ 11. Contribution Guide

* Fork + PR welcome (especially for disposable domain list updates).
* Code style: Prettier + ESLint.
* Commit format: Conventional Commits (`feat:`, `fix:`, `chore:`).
* Run tests before PR:

  ```bash
  bun test
  ```

---

## ğŸ“œ 12. License

MIT Â© 2025 [Shaswat Raj](https://shaswat.live)

---

âš¡ This **context file** should be loaded into your AI IDE so it understands:

* Tech stack
* Architecture
* DB schema
* API routes
* Testing & deployment process
* Roadmap

---

Do you want me to also **write the wrangler.toml** so Copilot instantly knows how to wire D1 + KV with Workers?
