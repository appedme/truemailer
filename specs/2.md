Perfect 👍 — you want a **full “context file”** that you can drop into your repo so AI assistants (Copilot, Cursor, Codeium, etc.) understand the **entire Truemailer dev lifecycle**: design → build → test → deploy → scale.

This will act like a **supercharged SPEC.md + CONTRIBUTING.md + roadmap** all in one.

---

# 📐 Truemailer – AI Context File

This document defines the **complete development context** for the Truemailer project.
It should guide AI IDE assistants (Copilot, Cursor, etc.) through the entire lifecycle:
**planning → development → testing → deployment → scaling.**

---

## 🔍 1. Project Overview

* **Name:** Truemailer
* **Type:** Email Validation API (SaaS)
* **Core Purpose:** Verify if an email is valid, disposable, or spammy.
* **Deployment:** Cloudflare Workers
* **Frontend (later):** Next.js (Cloudflare Pages) for docs + dashboard
* **API Framework:** Hono (TypeScript)
* **Runtime (dev):** Bun
* **Database:** Cloudflare D1 (SQL) + KV for fast lookups

---

## 🚀 2. Features

### MVP

* Syntax validation (RFC 5322 compliant regex)
* Domain & MX record validation
* Disposable/temporary email detection (blocklist JSON)
* Spam scoring heuristics
* API key authentication (KV + D1)
* Usage tracking per key

### Roadmap

* SMTP verification (Pro plan feature)
* Catch-all detection
* Stripe/Razorpay billing integration
* Admin dashboard for managing users + API keys
* Docs site + interactive API playground
* Auto-updated disposable email list via GitHub Actions
* Analytics & fraud detection (flag suspicious usage patterns)

---

## 🛠️ 3. Architecture

### Request Flow

```
Client → Cloudflare Worker (Hono) → Middleware (Auth) → Validation Logic → Response
```

### Components

* **Hono Router** → defines endpoints (`/validate`, `/health`)
* **Middleware** → API key validation + rate limiting
* **Validation Utils** → syntax, MX, disposable, spam scoring
* **Database Layer** → D1 for users/keys/usage, KV for fast API key lookups
* **Deployment** → `wrangler.toml` config

---

## 📂 4. Folder Structure

```
truemailer/
│── src/
│   ├── index.ts            # Main Hono entrypoint
│   ├── utils/
│   │   ├── validate.ts     # Syntax + MX checks
│   │   ├── disposable.ts   # Disposable domain list
│   │   ├── spam.ts         # Spam scoring heuristics
│   └── middleware/
│       └── auth.ts         # API key auth middleware
│── db/
│   ├── schema.sql          # D1 schema
│   └── migrations/         # SQL migrations
│── tests/
│   ├── validate.test.ts    # Unit tests
│   └── api.test.ts         # Integration tests
│── package.json
│── wrangler.toml
│── README.md
│── CONTEXT.md              # This file
```

---

## 🗄️ 5. Database Design (D1)

```sql
-- Users table
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  plan TEXT DEFAULT 'free',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- API Keys
CREATE TABLE api_keys (
  key TEXT PRIMARY KEY,
  user_id TEXT REFERENCES users(id),
  active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Usage Logs
CREATE TABLE usage (
  id TEXT PRIMARY KEY,
  api_key TEXT REFERENCES api_keys(key),
  count INTEGER DEFAULT 0,
  month TEXT, -- format: YYYY-MM
  last_used TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 🔑 6. API Spec

### `GET /validate`

Validate an email.

**Query Params:**

* `email` (string, required)
* `apikey` (string, required)

**Response:**

```json
{
  "email": "test@gmail.com",
  "valid_syntax": true,
  "domain_exists": true,
  "is_disposable": false,
  "spam_score": 5,
  "verdict": "good"
}
```

### `GET /health`

Health check endpoint.

```json
{ "status": "ok" }
```

---

## 🧪 7. Testing Strategy

* **Unit Tests** → validation logic (`spam.ts`, `validate.ts`).
* **Integration Tests** → API endpoint responses.
* **Load Testing** → k6 / wrk to simulate high request volume.
* **CI/CD** → GitHub Actions runs tests on push.

---

## ⚡ 8. Deployment

* **Platform:** Cloudflare Workers
* **Config:** `wrangler.toml`
* **Commands:**

  ```bash
  bun install
  bun run dev       # local dev
  wrangler dev      # worker dev
  wrangler publish  # deploy
  ```

---

## 📊 9. Monitoring & Scaling

* **Logs:** Cloudflare Logs for request monitoring
* **Quota Enforcement:** Durable Objects (per-key request counter)
* **Caching:** Cloudflare KV for API key validation
* **Error Tracking:** Sentry/Logflare integration

---

## 📈 10. Development Lifecycle Checklist

✅ **Plan** → Define features & schema
✅ **Build** → Implement Hono routes + utils
✅ **Test** → Unit + integration tests
✅ **Deploy** → Publish on Cloudflare Workers
✅ **Monitor** → Logs, error tracking
🔜 **Scale** → Rate limits, billing, dashboard

---

## 🤝 11. Contribution Guide

* Fork + PR welcome (especially for disposable domain list updates).
* Code style: Prettier + ESLint.
* Commit format: Conventional Commits (`feat:`, `fix:`, `chore:`).
* Run tests before PR:

  ```bash
  bun test
  ```

---

## 📜 12. License

MIT © 2025 [Shaswat Raj](https://shaswat.live)

---

⚡ This **context file** should be loaded into your AI IDE so it understands:

* Tech stack
* Architecture
* DB schema
* API routes
* Testing & deployment process
* Roadmap

---

Do you want me to also **write the wrangler.toml** so Copilot instantly knows how to wire D1 + KV with Workers?
