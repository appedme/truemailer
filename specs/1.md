Got it âœ… â€” you want me to create **specs/instructions for GitHub Copilot (or any AI IDE assistant)** so it can scaffold **Truemailer** in a structured way.

Hereâ€™s a **clear spec document** you can drop into your repo (like `SPEC.md`) so Copilot can generate your code correctly.

---

# ğŸ“ Truemailer â€“ Build Specifications for AI IDE

This document defines the **specs** for building the **Truemailer Email Validation API** using **Hono + Cloudflare Workers**.
The AI IDE (GitHub Copilot, Cursor, etc.) should follow these instructions when generating code.

---

## 1. ğŸ“‚ Project Setup

* Language: **TypeScript**
* Runtime: **Bun** (for local dev), deploy to **Cloudflare Workers**
* Framework: **[Hono](https://hono.dev/)**
* Config: `wrangler.toml` for deployment

### Folder Structure

```
truemailer/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ index.ts          # Hono entrypoint (API routes)
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ validate.ts   # syntax + MX record validation
â”‚   â”‚   â”œâ”€â”€ disposable.ts # list of disposable domains
â”‚   â”‚   â”œâ”€â”€ spam.ts       # spam scoring heuristics
â”‚   â””â”€â”€ middleware/
â”‚       â””â”€â”€ auth.ts       # API key validation middleware
â”‚â”€â”€ package.json
â”‚â”€â”€ wrangler.toml
â”‚â”€â”€ README.md
â”‚â”€â”€ SPEC.md
```

---

## 2. ğŸ”‘ API Design

### Base URL

```
https://api.truemailer.io
```

### Endpoints

#### `GET /validate`

Validates an email.

**Query Params:**

* `email` (string, required)
* `apikey` (string, required)

**Response JSON:**

```json
{
  "email": "test@gmail.com",
  "valid_syntax": true,
  "domain_exists": true,
  "is_disposable": false,
  "spam_score": 5,
  "verdict": "good"
}
```

---

## 3. ğŸ›  Validation Logic

### 3.1 Syntax Validation

* Use **regex** based on RFC 5322 for email format.
* Example: `^[^\s@]+@[^\s@]+\.[^\s@]+$`

### 3.2 Domain & MX Record Check

* Extract domain from email.
* Use **DNS MX lookup** (via Cloudflare Workersâ€™ `fetch` to DNS API or Node `dns/promises` in Bun).
* If MX records exist â†’ `domain_exists = true`.

### 3.3 Disposable Email Detection

* Maintain a JSON file (`disposable-domains.json`) inside `src/utils/disposable.ts`.
* Function: `checkDisposable(domain: string): boolean`

### 3.4 Spam Score Calculation

Function:

```ts
function calculateSpamScore(email: string, domain: string, isDisposable: boolean): number
```

Heuristics:

* `+50` if disposable
* `+20` if domain < 1 month old (WHOIS API)
* `+10` if local-part looks random (e.g. `a1b2c3d4`)
* Default score = 0

### 3.5 Verdict

* `spam_score < 20` â†’ `"good"`
* `20â€“60` â†’ `"suspicious"`
* `> 60` â†’ `"spam"`

---

## 4. ğŸ” API Authentication

* Each user has an **API key**.
* Store keys in **KV storage** (Cloudflare Workers KV).
* Middleware `auth.ts`:

  * Extract `apikey` from query param.
  * Validate against KV store.
  * If invalid â†’ return `{ "error": "Invalid API key" }`.

---

## 5. ğŸ§ª Example Code Stubs

### index.ts

```ts
import { Hono } from 'hono'
import { validateEmail } from './utils/validate'
import { authMiddleware } from './middleware/auth'

const app = new Hono()

app.use('*', authMiddleware)

app.get('/validate', async (c) => {
  const email = c.req.query('email')
  const result = await validateEmail(email)
  return c.json(result)
})

export default app
```

### utils/validate.ts

```ts
import { checkDisposable } from './disposable'
import { calculateSpamScore } from './spam'
import dns from 'dns/promises'

export async function validateEmail(email: string) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  const validSyntax = emailRegex.test(email)

  if (!validSyntax) return { email, valid_syntax: false, verdict: 'invalid' }

  const domain = email.split('@')[1]
  let domainExists = false
  try {
    const mx = await dns.resolveMx(domain)
    domainExists = mx && mx.length > 0
  } catch (_) {
    domainExists = false
  }

  const isDisposable = checkDisposable(domain)
  const spamScore = calculateSpamScore(email, domain, isDisposable)

  return {
    email,
    valid_syntax: true,
    domain_exists: domainExists,
    is_disposable: isDisposable,
    spam_score: spamScore,
    verdict: spamScore > 60 ? 'spam' : spamScore > 20 ? 'suspicious' : 'good'
  }
}
```

---

## 6. ğŸ›  Future Enhancements

* [ ] SMTP verification (Pro tier).
* [ ] Catch-all domain detection.
* [ ] Dashboard with usage stats.
* [ ] Stripe/Razorpay integration for billing.
* [ ] Daily updated disposable domain list (via GitHub Actions).

---

âœ… With this spec, Copilot (or Cursor) will **understand your intent** and scaffold the Truemailer project properly.

---

Do you want me to also **write the `wrangler.toml` config** so Copilot immediately knows how to deploy this to Cloudflare Workers?
